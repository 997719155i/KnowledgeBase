# Partition

> 通过 partition by [姓名] order by [打卡时间] desc，
>
> 让数据按照姓名分组，并且在每组内部按照时间进行排序

## ClockInRecord表

| ID   | Name | ClockInTime |
| ---- | ---- | ----------- |
| 1    | 小明 | 2020/10/7   |
| 2    | 小明 | 2020/10/8   |
| 3    | 小明 | 2020/10/9   |
| 4    | 小明 | 2020/10/10  |
| 5    | 小明 | 2020/10/11  |
| 6    | 小王 | 2020/10/12  |
| 7    | 小王 | 2020/10/13  |
| 8    | 小王 | 2020/10/14  |
| 9    | 小王 | 2020/10/15  |
| 10   | 小王 | 2020/10/16  |
| 11   | 小王 | 2020/10/17  |
| 12   | 小王 | 2020/10/18  |
| 13   | 小王 | 2020/10/19  |
| 14   | 小李 | 2020/10/20  |
| 15   | 小李 | 2020/10/21  |
| 16   | 小李 | 2020/10/22  |
| 17   | 小李 | 2020/10/23  |
| 18   | 小李 | 2020/10/24  |

## SQL语句

```
SELECT 
	ROW_NUMBER() over(partition by [姓名] order by [打卡时间] desc) as rowNum
	,[姓名]
	,[打卡时间]
	FROM [dbo].[打卡记录表]    
```

| rowNum | Name | ClockInTime |
| ------ | ---- | ----------- |
| 1      | 小李 | 2020/10/24  |
| 2      | 小李 | 2020/10/23  |
| 3      | 小李 | 2020/10/22  |
| 4      | 小李 | 2020/10/21  |
| 5      | 小李 | 2020/10/20  |
| 1      | 小明 | 2020/10/11  |
| 2      | 小明 | 2020/10/10  |
| 3      | 小明 | 2020/10/9   |
| 4      | 小明 | 2020/10/8   |
| 5      | 小明 | 2020/10/7   |
| 1      | 小王 | 2020/10/19  |
| 2      | 小王 | 2020/10/18  |
| 3      | 小王 | 2020/10/17  |
| 4      | 小王 | 2020/10/16  |
| 5      | 小王 | 2020/10/15  |
| 6      | 小王 | 2020/10/14  |
| 7      | 小王 | 2020/10/13  |
| 8      | 小王 | 2020/10/12  |

## 取出每人最近打卡时间

```
select * from
         (
           SELECT 
               ROW_NUMBER() over(partition by [姓名] order by [打卡时间] desc) as rowNum
               ,[姓名]
               ,[打卡时间]
           FROM [dbo].[打卡记录表]
         ) temp
         where temp.rowNum = 1
```

| rowNum | Name | ClockInTime |
| ------ | ---- | ----------- |
| 1      | 小李 | 2020/10/24  |
| 1      | 小明 | 2020/10/11  |
| 1      | 小王 | 2020/10/19  |

# SQL

## 建表语句

``` 
USE [TEST_DB]
GO

/****** Object:  Table [dbo].[ClockInRecord]    Script Date: 2020/11/9 11:58:30 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[ClockInRecord](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Name] [nchar](10) NOT NULL,
	[ClockInTime] [datetime] NOT NULL,
 CONSTRAINT [PK_ClockInRecord] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
```

## 插入语句

``` 
insert into [ClockInRecord]
	([Name],[ClockInTime]) 
VALUES
	('小明','2020-10-07'),
	('小明','2020-10-08'),
	('小明','2020-10-09'),
	('小明','2020-10-10'),
	('小明','2020-10-11'),
	('小王','2020-10-12'),
	('小王','2020-10-13'),
  	('小王','2020-10-14'),
  	('小王','2020-10-15'),
  	('小王','2020-10-16'),
  	('小王','2020-10-17'),
  	('小王','2020-10-18'),
  	('小王','2020-10-19'),
  	('小李','2020-10-20'),
  	('小李','2020-10-21'),
  	('小李','2020-10-22'),
  	('小李','2020-10-23'),
  	('小李','2020-10-24')
```



--insert into [ClockInRecord] ([Name]
  --    ,[ClockInTime])
  --VALUES
  --('小明','2020-10-07'),
  --('小明','2020-10-08'),
  --('小明','2020-10-09'),
  --('小明','2020-10-10'),
  --('小明','2020-10-11'),
  --('小王','2020-10-12'),
  --('小王','2020-10-13'),
  --('小王','2020-10-14'),
  --('小王','2020-10-15'),
  --('小王','2020-10-16'),
  --('小王','2020-10-17'),
  --('小王','2020-10-18'),
  --('小王','2020-10-19'),
  --('小李','2020-10-20'),
  --('小李','2020-10-21'),
  --('小李','2020-10-22'),
  --('小李','2020-10-23'),
  --('小李','2020-10-24')

